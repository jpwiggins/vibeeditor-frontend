(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function d(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(e){if(e.ep)return;e.ep=!0;const s=d(e);fetch(e.href,s)}})();document.getElementById("edit-form").addEventListener("submit",async function(o){o.preventDefault(),document.getElementById("video-preview").style.display="none",document.getElementById("payment-section").style.display="none",document.getElementById("progress-message").textContent="Uploading and processing...",document.getElementById("progress-fill").style.width="10%";const t=new FormData(this);if(!document.getElementById("prompt").value){const n=document.getElementById("prompt-select").value;n&&t.set("prompt",n)}try{const e=await(await fetch("/api/edit",{method:"POST",body:t})).json();e.task_id?i(e.task_id):document.getElementById("progress-message").textContent="Failed to start processing."}catch{document.getElementById("progress-message").textContent="Error uploading file."}});async function i(o){document.getElementById("progress-fill").style.width="30%";let t=!1;for(;!t;){await new Promise(e=>setTimeout(e,2e3));const n=await(await fetch(`/api/status/${o}`)).json();n.status==="done"&&n.preview_url?(c(n.original_url,n.preview_url),t=!0):n.status==="failed"?(document.getElementById("progress-message").textContent="Processing failed.",t=!0):document.getElementById("progress-message").textContent=`Processing... (${n.status})`}document.getElementById("progress-fill").style.width="100%"}function c(o,t){o&&(document.getElementById("original-player").src=o),document.getElementById("preview-player").src=t,document.getElementById("video-preview").style.display="block",document.getElementById("payment-section").style.display="block",document.getElementById("progress-message").textContent="Preview ready. Please complete payment to download."}document.getElementById("pay-button").addEventListener("click",async function(){document.getElementById("progress-message").textContent="Processing payment...";const t=await(await fetch("/api/pay",{method:"POST"})).json();t.download_url?document.getElementById("progress-message").innerHTML=`<a href="${t.download_url}" download>Download Final Video</a>`:document.getElementById("progress-message").textContent="Payment failed."});const r=document.getElementById("drop-zone"),a=document.getElementById("video");r.addEventListener("click",()=>a.click());r.addEventListener("dragover",o=>{o.preventDefault(),r.classList.add("hover")});r.addEventListener("dragleave",()=>r.classList.remove("hover"));r.addEventListener("drop",o=>{o.preventDefault(),r.classList.remove("hover"),a.files=o.dataTransfer.files});document.querySelector('button[aria-label="Open help modal"]').addEventListener("click",()=>{document.getElementById("help-modal").style.display="block"});document.querySelector('button[aria-label="Close help modal"]').addEventListener("click",()=>{document.getElementById("help-modal").style.display="none"});
